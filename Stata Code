
* Prepare NSQIP 2018-2021

* Determine Common Variables Between Datasets
* Load the first dataset and get its variable list
use "Y:\Tyler Zander\NSQIP\NSQIP_2021.dta", clear
ds
local commonvars `r(varlist)'

* Compare with the second dataset
use "Y:\Tyler Zander\NSQIP\NSQIP 2020.dta", clear
ds
local tempvarlist `r(varlist)'
local commonvars : list commonvars & tempvarlist

* Compare with the third dataset
use "Y:\Tyler Zander\NSQIP\NSQIP 2019.dta", clear
ds
local tempvarlist `r(varlist)'
local commonvars : list commonvars & tempvarlist

* Compare with the fourth dataset
use "Y:\Tyler Zander\NSQIP\NSQIP 2018.dta", clear
ds
local tempvarlist `r(varlist)'
local commonvars : list commonvars & tempvarlist

* Display the common variables
display "Common variables: `commonvars'"

* Count the number of common variables
local numvars = wordcount("`commonvars'")
display "Number of common variables: `numvars'"

* COMMON VARIABLES BETWEEN 2018-2021
*\PUFYEAR CaseID SEX RACE_NEW ETHNICITY_HISPANIC PRNCPTX CPT WORKRVU INOUT TRANST Age AdmYR OperYR DISCHDEST ANESTHES SURGSPEC HEIGHT WEIGHT DIABETES SMOKE FNSTATUS2 VENTILAT HXCOPD ASCITES HXCHF HYPERMED DIALYSIS DISCANCR STEROID BLEEDDIS TRANSFUS PRSEPIS DPRNA DPRBUN DPRCREAT DPRALBUM DPRBILI DPRSGOT DPRALKP DPRWBC DPRHCT DPRPLATE DPRPTT DPRINR PRSODM PRBUN PRCREAT PRALBUM PRBILI PRSGOT PRALKPH PRWBC PRHCT PRPLATE PRPTT PRINR OTHERPROC1 OTHERCPT1 OTHERWRVU1 OTHERPROC2 OTHERCPT2 OTHERWRVU2 OTHERPROC3 OTHERCPT3 OTHERWRVU3 OTHERPROC4 OTHERCPT4 OTHERWRVU4 OTHERPROC5 OTHERCPT5 OTHERWRVU5 OTHERPROC6 OTHERCPT6 OTHERWRVU6 OTHERPROC7 OTHERCPT7 OTHERWRVU7 OTHERPROC8 OTHERCPT8 OTHERWRVU8 OTHERPROC9 OTHERCPT9 OTHERWRVU9 OTHERPROC10 OTHERCPT10 OTHERWRVU10 CONCURR1 CONCPT1 CONWRVU1 CONCURR2 CONCPT2 CONWRVU2 CONCURR3 CONCPT3 CONWRVU3 CONCURR4 CONCPT4 CONWRVU4 CONCURR5 CONCPT5 CONWRVU5 CONCURR6 CONCPT6 CONWRVU6 CONCURR7 CONCPT7 CONWRVU7 CONCURR8 CONCPT8 CONWRVU8 CONCURR9 CONCPT9 CONWRVU9 CONCURR10 CONCPT10 CONWRVU10 ASACLAS MORTPROB MORBPROB OPTIME HDISDT YRDEATH TOTHLOS AdmQtr HtoODay NSUPINFEC SUPINFEC SSSIPATOS DSUPINFEC NWNDINFD WNDINFD DSSIPATOS DWNDINFD NORGSPCSSI ORGSPCSSI OSSIPATOS DORGSPCSSI NDEHIS DEHIS DDEHIS NOUPNEUMO OUPNEUMO PNAPATOS DOUPNEUMO NREINTUB REINTUB DREINTUB NPULEMBOL PULEMBOL DPULEMBOL NFAILWEAN FAILWEAN VENTPATOS DFAILWEAN NOPRENAFL OPRENAFL DOPRENAFL NURNINFEC URNINFEC UTIPATOS DURNINFEC NCNSCVA CNSCVA DCNSCVA NCDARREST CDARREST  DCDARREST NCDMI CDMI DCDMI NOTHBLEED OTHBLEED DOTHBLEED NOTHDVT OTHDVT DOTHDVT NOTHSYSEP OTHSYSEP SEPSISPATOS DOTHSYSEP NOTHSESHOCK OTHSESHOCK SEPSHOCKPATOS DOTHSESHOCK PODIAG10 PODIAGTX10 RETURNOR DOpertoD DOptoDis STILLINHOSP  REOPERATION1 RETORPODAYS REOPORCPT1 RETORRELATED REOPOR1ICD101 REOPERATION2 RETOR2PODAYS REOPOR2CPT1 RETOR2RELATED REOPOR2ICD101 REOPERATION3 READMISSION1 READMPODAYS1 UNPLANNEDREADMISSION1 READMRELATED1 READMSUSPREASON1 READMUNRELSUSP1 READMRELICD101 READMUNRELICD101 READMISSION2 READMPODAYS2 UNPLANNEDREADMISSION2 READMRELATED2 READMSUSPREASON2 READMUNRELSUSP2 READMRELICD102 READMUNRELICD102 READMISSION3 READMPODAYS3 UNPLANNEDREADMISSION3 READMRELATED3 READMSUSPREASON3 READMUNRELSUSP3 READMRELICD103 READMUNRELICD103 READMISSION4 READMPODAYS4 UNPLANNEDREADMISSION4 READMRELATED4 READMSUSPREASON4 READMUNRELSUSP4 READMRELICD104 READMUNRELICD104 READMISSION5 READMPODAYS5 UNPLANNEDREADMISSION5 READMRELATED5 READMSUSPREASON5 READMUNRELSUSP5 READMRELICD105 READMUNRELICD105 PODIAG_OTHER10 ANESTHES_OTHER OTHCDIFF NOTHCDIFF DOTHCDIFF
\*

clear
use "Y:\Tyler Zander\NSQIP\NSQIP_2021.dta"

keep PUFYEAR CaseID SEX RACE_NEW ETHNICITY_HISPANIC PRNCPTX CPT WORKRVU INOUT TRANST Age AdmYR OperYR DISCHDEST ANESTHES SURGSPEC HEIGHT WEIGHT DIABETES SMOKE FNSTATUS2 VENTILAT HXCOPD ASCITES HXCHF HYPERMED DIALYSIS DISCANCR STEROID BLEEDDIS TRANSFUS PRSEPIS DPRNA DPRBUN DPRCREAT DPRALBUM DPRBILI DPRSGOT DPRALKP DPRWBC DPRHCT DPRPLATE DPRPTT DPRINR PRSODM PRBUN PRCREAT PRALBUM PRBILI PRSGOT PRALKPH PRWBC PRHCT PRPLATE PRPTT PRINR OTHERPROC1 OTHERCPT1 OTHERWRVU1 OTHERPROC2 OTHERCPT2 OTHERWRVU2 OTHERPROC3 OTHERCPT3 OTHERWRVU3 OTHERPROC4 OTHERCPT4 OTHERWRVU4 OTHERPROC5 OTHERCPT5 OTHERWRVU5 OTHERPROC6 OTHERCPT6 OTHERWRVU6 OTHERPROC7 OTHERCPT7 OTHERWRVU7 OTHERPROC8 OTHERCPT8 OTHERWRVU8 OTHERPROC9 OTHERCPT9 OTHERWRVU9 OTHERPROC10 OTHERCPT10 OTHERWRVU10 CONCURR1 CONCPT1 CONWRVU1 CONCURR2 CONCPT2 CONWRVU2 CONCURR3 CONCPT3 CONWRVU3 CONCURR4 CONCPT4 CONWRVU4 CONCURR5 CONCPT5 CONWRVU5 CONCURR6 CONCPT6 CONWRVU6 CONCURR7 CONCPT7 CONWRVU7 CONCURR8 CONCPT8 CONWRVU8 CONCURR9 CONCPT9 CONWRVU9 CONCURR10 CONCPT10 CONWRVU10 ASACLAS MORTPROB MORBPROB OPTIME HDISDT YRDEATH TOTHLOS AdmQtr HtoODay NSUPINFEC SUPINFEC SSSIPATOS DSUPINFEC NWNDINFD WNDINFD DSSIPATOS DWNDINFD NORGSPCSSI ORGSPCSSI OSSIPATOS DORGSPCSSI NDEHIS DEHIS DDEHIS NOUPNEUMO OUPNEUMO PNAPATOS DOUPNEUMO NREINTUB REINTUB DREINTUB NPULEMBOL PULEMBOL DPULEMBOL NFAILWEAN FAILWEAN VENTPATOS DFAILWEAN NOPRENAFL OPRENAFL DOPRENAFL NURNINFEC URNINFEC UTIPATOS DURNINFEC NCNSCVA CNSCVA DCNSCVA NCDARREST CDARREST  DCDARREST NCDMI CDMI DCDMI NOTHBLEED OTHBLEED DOTHBLEED NOTHDVT OTHDVT DOTHDVT NOTHSYSEP OTHSYSEP SEPSISPATOS DOTHSYSEP NOTHSESHOCK OTHSESHOCK SEPSHOCKPATOS DOTHSESHOCK PODIAG10 PODIAGTX10 RETURNOR DOpertoD DOptoDis STILLINHOSP  REOPERATION1 RETORPODAYS REOPORCPT1 RETORRELATED REOPOR1ICD101 REOPERATION2 RETOR2PODAYS REOPOR2CPT1 RETOR2RELATED REOPOR2ICD101 REOPERATION3 READMISSION1 READMPODAYS1 UNPLANNEDREADMISSION1 READMRELATED1 READMSUSPREASON1 READMUNRELSUSP1 READMRELICD101 READMUNRELICD101 READMISSION2 READMPODAYS2 UNPLANNEDREADMISSION2 READMRELATED2 READMSUSPREASON2 READMUNRELSUSP2 READMRELICD102 READMUNRELICD102 READMISSION3 READMPODAYS3 UNPLANNEDREADMISSION3 READMRELATED3 READMSUSPREASON3 READMUNRELSUSP3 READMRELICD103 READMUNRELICD103 READMISSION4 READMPODAYS4 UNPLANNEDREADMISSION4 READMRELATED4 READMSUSPREASON4 READMUNRELSUSP4 READMRELICD104 READMUNRELICD104 READMISSION5 READMPODAYS5 UNPLANNEDREADMISSION5 READMRELATED5 READMSUSPREASON5 READMUNRELSUSP5 READMRELICD105 READMUNRELICD105 PODIAG_OTHER10 ANESTHES_OTHER OTHCDIFF NOTHCDIFF DOTHCDIFF

save "Y:\Tyler Zander\NSQIP\NSQIP_2021V2.dta", replace

clear
use "Y:\Tyler Zander\NSQIP\NSQIP 2020.dta"

keep PUFYEAR CaseID SEX RACE_NEW ETHNICITY_HISPANIC PRNCPTX CPT WORKRVU INOUT TRANST Age AdmYR OperYR DISCHDEST ANESTHES SURGSPEC HEIGHT WEIGHT DIABETES SMOKE FNSTATUS2 VENTILAT HXCOPD ASCITES HXCHF HYPERMED DIALYSIS DISCANCR STEROID BLEEDDIS TRANSFUS PRSEPIS DPRNA DPRBUN DPRCREAT DPRALBUM DPRBILI DPRSGOT DPRALKP DPRWBC DPRHCT DPRPLATE DPRPTT DPRINR PRSODM PRBUN PRCREAT PRALBUM PRBILI PRSGOT PRALKPH PRWBC PRHCT PRPLATE PRPTT PRINR OTHERPROC1 OTHERCPT1 OTHERWRVU1 OTHERPROC2 OTHERCPT2 OTHERWRVU2 OTHERPROC3 OTHERCPT3 OTHERWRVU3 OTHERPROC4 OTHERCPT4 OTHERWRVU4 OTHERPROC5 OTHERCPT5 OTHERWRVU5 OTHERPROC6 OTHERCPT6 OTHERWRVU6 OTHERPROC7 OTHERCPT7 OTHERWRVU7 OTHERPROC8 OTHERCPT8 OTHERWRVU8 OTHERPROC9 OTHERCPT9 OTHERWRVU9 OTHERPROC10 OTHERCPT10 OTHERWRVU10 CONCURR1 CONCPT1 CONWRVU1 CONCURR2 CONCPT2 CONWRVU2 CONCURR3 CONCPT3 CONWRVU3 CONCURR4 CONCPT4 CONWRVU4 CONCURR5 CONCPT5 CONWRVU5 CONCURR6 CONCPT6 CONWRVU6 CONCURR7 CONCPT7 CONWRVU7 CONCURR8 CONCPT8 CONWRVU8 CONCURR9 CONCPT9 CONWRVU9 CONCURR10 CONCPT10 CONWRVU10 ASACLAS MORTPROB MORBPROB OPTIME HDISDT YRDEATH TOTHLOS AdmQtr HtoODay NSUPINFEC SUPINFEC SSSIPATOS DSUPINFEC NWNDINFD WNDINFD DSSIPATOS DWNDINFD NORGSPCSSI ORGSPCSSI OSSIPATOS DORGSPCSSI NDEHIS DEHIS DDEHIS NOUPNEUMO OUPNEUMO PNAPATOS DOUPNEUMO NREINTUB REINTUB DREINTUB NPULEMBOL PULEMBOL DPULEMBOL NFAILWEAN FAILWEAN VENTPATOS DFAILWEAN NOPRENAFL OPRENAFL DOPRENAFL NURNINFEC URNINFEC UTIPATOS DURNINFEC NCNSCVA CNSCVA DCNSCVA NCDARREST CDARREST  DCDARREST NCDMI CDMI DCDMI NOTHBLEED OTHBLEED DOTHBLEED NOTHDVT OTHDVT DOTHDVT NOTHSYSEP OTHSYSEP SEPSISPATOS DOTHSYSEP NOTHSESHOCK OTHSESHOCK SEPSHOCKPATOS DOTHSESHOCK PODIAG10 PODIAGTX10 RETURNOR DOpertoD DOptoDis STILLINHOSP  REOPERATION1 RETORPODAYS REOPORCPT1 RETORRELATED REOPOR1ICD101 REOPERATION2 RETOR2PODAYS REOPOR2CPT1 RETOR2RELATED REOPOR2ICD101 REOPERATION3 READMISSION1 READMPODAYS1 UNPLANNEDREADMISSION1 READMRELATED1 READMSUSPREASON1 READMUNRELSUSP1 READMRELICD101 READMUNRELICD101 READMISSION2 READMPODAYS2 UNPLANNEDREADMISSION2 READMRELATED2 READMSUSPREASON2 READMUNRELSUSP2 READMRELICD102 READMUNRELICD102 READMISSION3 READMPODAYS3 UNPLANNEDREADMISSION3 READMRELATED3 READMSUSPREASON3 READMUNRELSUSP3 READMRELICD103 READMUNRELICD103 READMISSION4 READMPODAYS4 UNPLANNEDREADMISSION4 READMRELATED4 READMSUSPREASON4 READMUNRELSUSP4 READMRELICD104 READMUNRELICD104 READMISSION5 READMPODAYS5 UNPLANNEDREADMISSION5 READMRELATED5 READMSUSPREASON5 READMUNRELSUSP5 READMRELICD105 READMUNRELICD105 PODIAG_OTHER10 ANESTHES_OTHER OTHCDIFF NOTHCDIFF DOTHCDIFF

save "Y:\Tyler Zander\NSQIP\NSQIP_2020V2.dta", replace

clear
use "Y:\Tyler Zander\NSQIP\NSQIP 2019.dta"

keep PUFYEAR CaseID SEX RACE_NEW ETHNICITY_HISPANIC PRNCPTX CPT WORKRVU INOUT TRANST Age AdmYR OperYR DISCHDEST ANESTHES SURGSPEC HEIGHT WEIGHT DIABETES SMOKE FNSTATUS2 VENTILAT HXCOPD ASCITES HXCHF HYPERMED DIALYSIS DISCANCR STEROID BLEEDDIS TRANSFUS PRSEPIS DPRNA DPRBUN DPRCREAT DPRALBUM DPRBILI DPRSGOT DPRALKP DPRWBC DPRHCT DPRPLATE DPRPTT DPRINR PRSODM PRBUN PRCREAT PRALBUM PRBILI PRSGOT PRALKPH PRWBC PRHCT PRPLATE PRPTT PRINR OTHERPROC1 OTHERCPT1 OTHERWRVU1 OTHERPROC2 OTHERCPT2 OTHERWRVU2 OTHERPROC3 OTHERCPT3 OTHERWRVU3 OTHERPROC4 OTHERCPT4 OTHERWRVU4 OTHERPROC5 OTHERCPT5 OTHERWRVU5 OTHERPROC6 OTHERCPT6 OTHERWRVU6 OTHERPROC7 OTHERCPT7 OTHERWRVU7 OTHERPROC8 OTHERCPT8 OTHERWRVU8 OTHERPROC9 OTHERCPT9 OTHERWRVU9 OTHERPROC10 OTHERCPT10 OTHERWRVU10 CONCURR1 CONCPT1 CONWRVU1 CONCURR2 CONCPT2 CONWRVU2 CONCURR3 CONCPT3 CONWRVU3 CONCURR4 CONCPT4 CONWRVU4 CONCURR5 CONCPT5 CONWRVU5 CONCURR6 CONCPT6 CONWRVU6 CONCURR7 CONCPT7 CONWRVU7 CONCURR8 CONCPT8 CONWRVU8 CONCURR9 CONCPT9 CONWRVU9 CONCURR10 CONCPT10 CONWRVU10 ASACLAS MORTPROB MORBPROB OPTIME HDISDT YRDEATH TOTHLOS AdmQtr HtoODay NSUPINFEC SUPINFEC SSSIPATOS DSUPINFEC NWNDINFD WNDINFD DSSIPATOS DWNDINFD NORGSPCSSI ORGSPCSSI OSSIPATOS DORGSPCSSI NDEHIS DEHIS DDEHIS NOUPNEUMO OUPNEUMO PNAPATOS DOUPNEUMO NREINTUB REINTUB DREINTUB NPULEMBOL PULEMBOL DPULEMBOL NFAILWEAN FAILWEAN VENTPATOS DFAILWEAN NOPRENAFL OPRENAFL DOPRENAFL NURNINFEC URNINFEC UTIPATOS DURNINFEC NCNSCVA CNSCVA DCNSCVA NCDARREST CDARREST  DCDARREST NCDMI CDMI DCDMI NOTHBLEED OTHBLEED DOTHBLEED NOTHDVT OTHDVT DOTHDVT NOTHSYSEP OTHSYSEP SEPSISPATOS DOTHSYSEP NOTHSESHOCK OTHSESHOCK SEPSHOCKPATOS DOTHSESHOCK PODIAG10 PODIAGTX10 RETURNOR DOpertoD DOptoDis STILLINHOSP  REOPERATION1 RETORPODAYS REOPORCPT1 RETORRELATED REOPOR1ICD101 REOPERATION2 RETOR2PODAYS REOPOR2CPT1 RETOR2RELATED REOPOR2ICD101 REOPERATION3 READMISSION1 READMPODAYS1 UNPLANNEDREADMISSION1 READMRELATED1 READMSUSPREASON1 READMUNRELSUSP1 READMRELICD101 READMUNRELICD101 READMISSION2 READMPODAYS2 UNPLANNEDREADMISSION2 READMRELATED2 READMSUSPREASON2 READMUNRELSUSP2 READMRELICD102 READMUNRELICD102 READMISSION3 READMPODAYS3 UNPLANNEDREADMISSION3 READMRELATED3 READMSUSPREASON3 READMUNRELSUSP3 READMRELICD103 READMUNRELICD103 READMISSION4 READMPODAYS4 UNPLANNEDREADMISSION4 READMRELATED4 READMSUSPREASON4 READMUNRELSUSP4 READMRELICD104 READMUNRELICD104 READMISSION5 READMPODAYS5 UNPLANNEDREADMISSION5 READMRELATED5 READMSUSPREASON5 READMUNRELSUSP5 READMRELICD105 READMUNRELICD105 PODIAG_OTHER10 ANESTHES_OTHER OTHCDIFF NOTHCDIFF DOTHCDIFF

save "Y:\Tyler Zander\NSQIP\NSQIP_2019V2.dta", replace

clear
use "Y:\Tyler Zander\NSQIP\NSQIP 2018.dta"

keep PUFYEAR CaseID SEX RACE_NEW ETHNICITY_HISPANIC PRNCPTX CPT WORKRVU INOUT TRANST Age AdmYR OperYR DISCHDEST ANESTHES SURGSPEC HEIGHT WEIGHT DIABETES SMOKE FNSTATUS2 VENTILAT HXCOPD ASCITES HXCHF HYPERMED DIALYSIS DISCANCR STEROID BLEEDDIS TRANSFUS PRSEPIS DPRNA DPRBUN DPRCREAT DPRALBUM DPRBILI DPRSGOT DPRALKP DPRWBC DPRHCT DPRPLATE DPRPTT DPRINR PRSODM PRBUN PRCREAT PRALBUM PRBILI PRSGOT PRALKPH PRWBC PRHCT PRPLATE PRPTT PRINR OTHERPROC1 OTHERCPT1 OTHERWRVU1 OTHERPROC2 OTHERCPT2 OTHERWRVU2 OTHERPROC3 OTHERCPT3 OTHERWRVU3 OTHERPROC4 OTHERCPT4 OTHERWRVU4 OTHERPROC5 OTHERCPT5 OTHERWRVU5 OTHERPROC6 OTHERCPT6 OTHERWRVU6 OTHERPROC7 OTHERCPT7 OTHERWRVU7 OTHERPROC8 OTHERCPT8 OTHERWRVU8 OTHERPROC9 OTHERCPT9 OTHERWRVU9 OTHERPROC10 OTHERCPT10 OTHERWRVU10 CONCURR1 CONCPT1 CONWRVU1 CONCURR2 CONCPT2 CONWRVU2 CONCURR3 CONCPT3 CONWRVU3 CONCURR4 CONCPT4 CONWRVU4 CONCURR5 CONCPT5 CONWRVU5 CONCURR6 CONCPT6 CONWRVU6 CONCURR7 CONCPT7 CONWRVU7 CONCURR8 CONCPT8 CONWRVU8 CONCURR9 CONCPT9 CONWRVU9 CONCURR10 CONCPT10 CONWRVU10 ASACLAS MORTPROB MORBPROB OPTIME HDISDT YRDEATH TOTHLOS AdmQtr HtoODay NSUPINFEC SUPINFEC SSSIPATOS DSUPINFEC NWNDINFD WNDINFD DSSIPATOS DWNDINFD NORGSPCSSI ORGSPCSSI OSSIPATOS DORGSPCSSI NDEHIS DEHIS DDEHIS NOUPNEUMO OUPNEUMO PNAPATOS DOUPNEUMO NREINTUB REINTUB DREINTUB NPULEMBOL PULEMBOL DPULEMBOL NFAILWEAN FAILWEAN VENTPATOS DFAILWEAN NOPRENAFL OPRENAFL DOPRENAFL NURNINFEC URNINFEC UTIPATOS DURNINFEC NCNSCVA CNSCVA DCNSCVA NCDARREST CDARREST  DCDARREST NCDMI CDMI DCDMI NOTHBLEED OTHBLEED DOTHBLEED NOTHDVT OTHDVT DOTHDVT NOTHSYSEP OTHSYSEP SEPSISPATOS DOTHSYSEP NOTHSESHOCK OTHSESHOCK SEPSHOCKPATOS DOTHSESHOCK PODIAG10 PODIAGTX10 RETURNOR DOpertoD DOptoDis STILLINHOSP  REOPERATION1 RETORPODAYS REOPORCPT1 RETORRELATED REOPOR1ICD101 REOPERATION2 RETOR2PODAYS REOPOR2CPT1 RETOR2RELATED REOPOR2ICD101 REOPERATION3 READMISSION1 READMPODAYS1 UNPLANNEDREADMISSION1 READMRELATED1 READMSUSPREASON1 READMUNRELSUSP1 READMRELICD101 READMUNRELICD101 READMISSION2 READMPODAYS2 UNPLANNEDREADMISSION2 READMRELATED2 READMSUSPREASON2 READMUNRELSUSP2 READMRELICD102 READMUNRELICD102 READMISSION3 READMPODAYS3 UNPLANNEDREADMISSION3 READMRELATED3 READMSUSPREASON3 READMUNRELSUSP3 READMRELICD103 READMUNRELICD103 READMISSION4 READMPODAYS4 UNPLANNEDREADMISSION4 READMRELATED4 READMSUSPREASON4 READMUNRELSUSP4 READMRELICD104 READMUNRELICD104 READMISSION5 READMPODAYS5 UNPLANNEDREADMISSION5 READMRELATED5 READMSUSPREASON5 READMUNRELSUSP5 READMRELICD105 READMUNRELICD105 PODIAG_OTHER10 ANESTHES_OTHER OTHCDIFF NOTHCDIFF DOTHCDIFF

save "Y:\Tyler Zander\NSQIP\NSQIP_2018V2.dta", replace

* Append files

clear
use "Y:\Tyler Zander\NSQIP\NSQIP_2021V2.dta"

append using "Y:\Tyler Zander\NSQIP\NSQIP_2020V2.dta"
append using "Y:\Tyler Zander\NSQIP\NSQIP_2019V2.dta"
append using "Y:\Tyler Zander\NSQIP\NSQIP_2018V2.dta"

save "Y:\Tyler Zander\NSQIP\NSQIP_2018_2021V3.dta", replace

*****************************************************************
* Query Hernia Patients

clear
use "Y:\Tyler Zander\NSQIP\NSQIP_2018_2021V3.dta"
*3,983,771 observations

gen Hernia = 0
replace Hernia = 1 if CPT == "49560" | OTHERCPT1 == "49560" | OTHERPROC2 == "49560" | OTHERCPT3 == "49560" | OTHERCPT4 == "49560" | OTHERCPT5 == "49560" | OTHERCPT6 == "49560" | OTHERCPT7 == "49560" | OTHERCPT8 == "49560" | OTHERCPT9 == "49560" | OTHERCPT10 == "49560" | CONCPT1 == "49560" | CONCPT2 == "49560" | CONCPT3 == "49560" | CONCPT4 == "49560" | CONCPT5 == "49560" | CONCPT6 == "49560" | CONCPT7 == "49560" | CONCPT8 == "49560" | CONCPT9 == "49560" | CONCPT10 == "49560"

gen Mesh = 0
replace Mesh = 1 if CPT == "49568" | OTHERCPT1 == "49568" | OTHERPROC2 == "49568" | OTHERCPT3 == "49568" | OTHERCPT4 == "49568" | OTHERCPT5 == "49568" | OTHERCPT6 == "49568" | OTHERCPT7 == "49568" | OTHERCPT8 == "49568" | OTHERCPT9 == "49568" | OTHERCPT10 == "49568" | CONCPT1 == "49568" | CONCPT2 == "49568" | CONCPT3 == "49568" | CONCPT4 == "49568" | CONCPT5 == "49568" | CONCPT6 == "49568" | CONCPT7 == "49568" | CONCPT8 == "49568" | CONCPT9 == "49568" | CONCPT10 == "49568"

gen HerniaRecurrent = 0
replace HerniaRecurrent = 1 if CPT == "49565" | OTHERCPT1 == "49565" | OTHERPROC2 == "49565" | OTHERCPT3 == "49565" | OTHERCPT4 == "49565" | OTHERCPT5 == "49565" | OTHERCPT6 == "49565" | OTHERCPT7 == "49565" | OTHERCPT8 == "49565" | OTHERCPT9 == "49565" | OTHERCPT10 == "49565" | CONCPT1 == "49565" | CONCPT2 == "49565" | CONCPT3 == "49565" | CONCPT4 == "49565" | CONCPT5 == "49565" | CONCPT6 == "49565" | CONCPT7 == "49565" | CONCPT8 == "49565" | CONCPT9 == "49565" | CONCPT10 == "49565"

tab UNPLANNEDREADMISSION1 if HerniaRecurrent == 1
tab UNPLANNEDREADMISSION1 if Hernia == 1

gen Initialincar = 0
replace Initialincar = 1 if CPT == "49561" | OTHERCPT1 == "49561" | OTHERPROC2 == "49561" | OTHERCPT3 == "49561" | OTHERCPT4 == "49561" | OTHERCPT5 == "49561" | OTHERCPT6 == "49561" | OTHERCPT7 == "49561" | OTHERCPT8 == "49561" | OTHERCPT9 == "49561" | OTHERCPT10 == "49561" | CONCPT1 == "49561" | CONCPT2 == "49561" | CONCPT3 == "49561" | CONCPT4 == "49561" | CONCPT5 == "49561" | CONCPT6 == "49561" | CONCPT7 == "49561" | CONCPT8 == "49561" | CONCPT9 == "49561" | CONCPT10 == "49561"

gen Recurincar = 0
replace Recurincar = 1 if CPT == "49566" | OTHERCPT1 == "49566" | OTHERPROC2 == "49566" | OTHERCPT3 == "49566" | OTHERCPT4 == "49566" | OTHERCPT5 == "49566" | OTHERCPT6 == "49566" | OTHERCPT7 == "49566" | OTHERCPT8 == "49566" | OTHERCPT9 == "49566" | OTHERCPT10 == "49566" | CONCPT1 == "49566" | CONCPT2 == "49566" | CONCPT3 == "49566" | CONCPT4 == "49566" | CONCPT5 == "49566" | CONCPT6 == "49566" | CONCPT7 == "49566" | CONCPT8 == "49566" | CONCPT9 == "49566" | CONCPT10 == "49566"

tab UNPLANNEDREADMISSION1 if Initialincar == 1
tab UNPLANNEDREADMISSION1 if Recurincar == 1

tab UNPLANNEDREADMISSION1 if HerniaRecurrent == 1
tab UNPLANNEDREADMISSION1 if Hernia == 1

gen Umbo = 0
replace Umbo = 1 if CPT == "49585" | OTHERCPT1 == "49585" | OTHERPROC2 == "49585" | OTHERCPT3 == "49585" | OTHERCPT4 == "49585" | OTHERCPT5 == "49585" | OTHERCPT6 == "49585" | OTHERCPT7 == "49585" | OTHERCPT8 == "49585" | OTHERCPT9 == "49585" | OTHERCPT10 == "49585" | CONCPT1 == "49585" | CONCPT2 == "49585" | CONCPT3 == "49585" | CONCPT4 == "49585" | CONCPT5 == "49585" | CONCPT6 == "49585" | CONCPT7 == "49585" | CONCPT8 == "49585" | CONCPT9 == "49585" | CONCPT10 == "49585"

gen Epigastric = 0
replace Epigastric = 1 if CPT == "49570" | OTHERCPT1 == "49570" | OTHERPROC2 == "49570" | OTHERCPT3 == "49570" | OTHERCPT4 == "49570" | OTHERCPT5 == "49570" | OTHERCPT6 == "49570" | OTHERCPT7 == "49570" | OTHERCPT8 == "49570" | OTHERCPT9 == "49570" | OTHERCPT10 == "49570" | CONCPT1 == "49570" | CONCPT2 == "49570" | CONCPT3 == "49570" | CONCPT4 == "49570" | CONCPT5 == "49570" | CONCPT6 == "49570" | CONCPT7 == "49570" | CONCPT8 == "49570" | CONCPT9 == "49570" | CONCPT10 == "49570"

tab UNPLANNEDREADMISSION1 if Umbo == 1
tab UNPLANNEDREADMISSION1 if Epigastric == 1

gen HerniaMesh = 0
replace HerniaMesh = 1 if Mesh == 1 & Hernia == 1 | HerniaRecurrent == 1 | Initialincar == 1 | Recurincar == 1

tab TOTHLOS if HerniaMesh == 1

tab READMISSION1 if HerniaMesh == 1

gen Complication = 0 

replace Complication = 1 if SUPINFEC == "Superficial Incisional SSI" | WNDINFD == "Deep Incisional SSI" | ORGSPCSSI == "Organ/Space SSI" | DEHIS == "Wound Disruption" | OUPNEUMO == "Pneumonia" | REINTUB == "Unplanned Intubation" | PULEMBOL == "Pulmonary Embolism" | URNINFEC == "Urinary Tract Infection" | CNSCVA == "Stroke/CVA" | CDARREST == "Cardiac Arrest Requiring CPR" | CDMI == "Myocardial Infarction" | OTHBLEED == "Transfusions/Intraop/Postop" | OTHDVT == "DVT Requiring Therapy" | OTHSYSEP == "Sepsis" | OTHSESHOCK == "Septic Shock" |OPRENAFL == "Acute Renal Failure" | FAILWEAN == "On Ventilator greater than 48 hours"

save "Y:\Tyler Zander\NSQIP Hernia\HerniaV1.dta", replace

*****************************************************************
clear
use "Y:\Tyler Zander\NSQIP Hernia\HerniaV1.dta"

keep if Hernia == 1 | HerniaRecurrent == 1 | Initialincar == 1 | Recurincar == 1
*3,898,122 deleted, 85,649 remain

gen ExLap = 0
replace ExLap = 1 if CPT == "49000" | OTHERCPT1 == "49000" | OTHERPROC2 == "49000" | OTHERCPT3 == "49000" | OTHERCPT4 == "49000" | OTHERCPT5 == "49000" | OTHERCPT6 == "49000" | OTHERCPT7 == "49000" | OTHERCPT8 == "49000" | OTHERCPT9 == "49000" | OTHERCPT10 == "49000" | CONCPT1 == "49000" | CONCPT2 == "49000" | CONCPT3 == "49000" | CONCPT4 == "49000" | CONCPT5 == "49000" | CONCPT6 == "49000" | CONCPT7 == "49000" | CONCPT8 == "49000" | CONCPT9 == "49000" | CONCPT10 == "49000"

// Enterolysis
gen Enterolysis = 0
replace Enterolysis = 1 if CPT == "44005" | OTHERCPT1 == "44005" | OTHERPROC2 == "44005" | OTHERCPT3 == "44005" | OTHERCPT4 == "44005" | OTHERCPT5 == "44005" | OTHERCPT6 == "44005" | OTHERCPT7 == "44005" | OTHERCPT8 == "44005" | OTHERCPT9 == "44005" | OTHERCPT10 == "44005" | CONCPT1 == "44005" | CONCPT2 == "44005" | CONCPT3 == "44005" | CONCPT4 == "44005" | CONCPT5 == "44005" | CONCPT6 == "44005" | CONCPT7 == "44005" | CONCPT8 == "44005" | CONCPT9 == "44005" | CONCPT10 == "44005"

// Omentectomy
gen Omentectomy = 0
replace Omentectomy = 1 if CPT == "49255" | OTHERCPT1 == "49255" | OTHERPROC2 == "49255" | OTHERCPT3 == "49255" | OTHERCPT4 == "49255" | OTHERCPT5 == "49255" | OTHERCPT6 == "49255" | OTHERCPT7 == "49255" | OTHERCPT8 == "49255" | OTHERCPT9 == "49255" | OTHERCPT10 == "49255" | CONCPT1 == "49255" | CONCPT2 == "49255" | CONCPT3 == "49255" | CONCPT4 == "49255" | CONCPT5 == "49255" | CONCPT6 == "49255" | CONCPT7 == "49255" | CONCPT8 == "49255" | CONCPT9 == "49255" | CONCPT10 == "49255"

// Enterorrhaphy
gen Enterorrhaphy = 0
replace Enterorrhaphy = 1 if CPT == "44602" | OTHERCPT1 == "44602" | OTHERPROC2 == "44602" | OTHERCPT3 == "44602" | OTHERCPT4 == "44602" | OTHERCPT5 == "44602" | OTHERCPT6 == "44602" | OTHERCPT7 == "44602" | OTHERCPT8 == "44602" | OTHERCPT9 == "44602" | OTHERCPT10 == "44602" | CONCPT1 == "44602" | CONCPT2 == "44602" | CONCPT3 == "44602" | CONCPT4 == "44602" | CONCPT5 == "44602" | CONCPT6 == "44602" | CONCPT7 == "44602" | CONCPT8 == "44602" | CONCPT9 == "44602" | CONCPT10 == "44602"

// Closure of Enterostomy
gen Closure_Enterostomy = 0
replace Closure_Enterostomy = 1 if CPT == "44620" | OTHERCPT1 == "44620" | OTHERPROC2 == "44620" | OTHERCPT3 == "44620" | OTHERCPT4 == "44620" | OTHERCPT5 == "44620" | OTHERCPT6 == "44620" | OTHERCPT7 == "44620" | OTHERCPT8 == "44620" | OTHERCPT9 == "44620" | OTHERCPT10 == "44620" | CONCPT1 == "44620" | CONCPT2 == "44620" | CONCPT3 == "44620" | CONCPT4 == "44620" | CONCPT5 == "44620" | CONCPT6 == "44620" | CONCPT7 == "44620" | CONCPT8 == "44620" | CONCPT9 == "44620" | CONCPT10 == "44620"

// Enterectomy
gen Enterectomy = 0
replace Enterectomy = 1 if CPT == "44120" | OTHERCPT1 == "44120" | OTHERPROC2 == "44120" | OTHERCPT3 == "44120" | OTHERCPT4 == "44120" | OTHERCPT5 == "44120" | OTHERCPT6 == "44120" | OTHERCPT7 == "44120" | OTHERCPT8 == "44120" | OTHERCPT9 == "44120" | OTHERCPT10 == "44120" | CONCPT1 == "44120" | CONCPT2 == "44120" | CONCPT3 == "44120" | CONCPT4 == "44120" | CONCPT5 == "44120" | CONCPT6 == "44120" | CONCPT7 == "44120" | CONCPT8 == "44120" | CONCPT9 == "44120" | CONCPT10 == "44120"

// Component Separation
gen Component_Separation = 0
replace Component_Separation = 1 if CPT == "15734" | OTHERCPT1 == "15734" | OTHERPROC2 == "15734" | OTHERCPT3 == "15734" | OTHERCPT4 == "15734" | OTHERCPT5 == "15734" | OTHERCPT6 == "15734" | OTHERCPT7 == "15734" | OTHERCPT8 == "15734" | OTHERCPT9 == "15734" | OTHERCPT10 == "15734" | CONCPT1 == "15734" | CONCPT2 == "15734" | CONCPT3 == "15734" | CONCPT4 == "15734" | CONCPT5 == "15734" | CONCPT6 == "15734" | CONCPT7 == "15734" | CONCPT8 == "15734" | CONCPT9 == "15734" | CONCPT10 == "15734"

// Panniculectomy
gen Panniculectomy = 0
replace Panniculectomy = 1 if CPT == "15830" | OTHERCPT1 == "15830" | OTHERPROC2 == "15830" | OTHERCPT3 == "15830" | OTHERCPT4 == "15830" | OTHERCPT5 == "15830" | OTHERCPT6 == "15830" | OTHERCPT7 == "15830" | OTHERCPT8 == "15830" | OTHERCPT9 == "15830" | OTHERCPT10 == "15830" | CONCPT1 == "15830" | CONCPT2 == "15830" | CONCPT3 == "15830" | CONCPT4 == "15830" | CONCPT5 == "15830" | CONCPT6 == "15830" | CONCPT7 == "15830" | CONCPT8 == "15830" | CONCPT9 == "15830" | CONCPT10 == "15830"

save "Y:\Tyler Zander\NSQIP Hernia\HerniaV2.dta", replace

*****************************************************************
* Exclude patients with excluded concomitant procedures

clear
use "Y:\Tyler Zander\NSQIP Hernia\HerniaV2.dta"

gen ZCPT = 0
gen ZOTHERCPT1 = 0
gen ZOTHERCPT2 = 0
gen ZOTHERCPT3 = 0
gen ZOTHERCPT4 = 0
gen ZOTHERCPT5 = 0
gen ZOTHERCPT6 = 0
gen ZOTHERCPT7 = 0
gen ZOTHERCPT8 = 0
gen ZOTHERCPT9 = 0
gen ZOTHERCPT10 = 0
gen ZCONCPT1 = 0
gen ZCONCPT2 = 0
gen ZCONCPT3 = 0
gen ZCONCPT4 = 0
gen ZCONCPT5 = 0
gen ZCONCPT6 = 0
gen ZCONCPT7 = 0
gen ZCONCPT8 = 0
gen ZCONCPT9 = 0
gen ZCONCPT10 = 0

replace ZCPT = 1 if CPT == "49560" | CPT == "49565" | CPT == "49568" | CPT == "49561" | CPT == "49566" | CPT == "49000" | CPT == "44005" | CPT == "49255" | CPT == "44602" | CPT == "44620" | CPT == "44120" | CPT == "15734" | CPT == "15830" | CPT == "NULL"
replace ZOTHERCPT1 = 1 if OTHERCPT1 == "49560" | OTHERCPT1 == "49565" | OTHERCPT1 == "49568" | OTHERCPT1 == "49561" | OTHERCPT1 == "49566" | OTHERCPT1 == "49000" | OTHERCPT1 == "44005" | OTHERCPT1 == "49255" | OTHERCPT1 == "44602" | OTHERCPT1 == "44620" | OTHERCPT1 == "44120" | OTHERCPT1 == "15734" | OTHERCPT1 == "15830" | OTHERCPT1 == "NULL"
replace ZOTHERCPT2 = 1 if OTHERCPT2 == "49560" | OTHERCPT2 == "49565" | OTHERCPT2 == "49568" | OTHERCPT2 == "49561" | OTHERCPT2 == "49566" | OTHERCPT2 == "49000" | OTHERCPT2 == "44005" | OTHERCPT2 == "49255" | OTHERCPT2 == "44602" | OTHERCPT2 == "44620" | OTHERCPT2 == "44120" | OTHERCPT2 == "15734" | OTHERCPT2 == "15830" | OTHERCPT2 == "NULL"
replace ZOTHERCPT3 = 1 if OTHERCPT3 == "49560" | OTHERCPT3 == "49565" | OTHERCPT3 == "49568" | OTHERCPT3 == "49561" | OTHERCPT3 == "49566" | OTHERCPT3 == "49000" | OTHERCPT3 == "44005" | OTHERCPT3 == "49255" | OTHERCPT3 == "44602" | OTHERCPT3 == "44620" | OTHERCPT3 == "44120" | OTHERCPT3 == "15734" | OTHERCPT3 == "15830" | OTHERCPT3 == "NULL"
replace ZOTHERCPT4 = 1 if OTHERCPT4 == "49560" | OTHERCPT4 == "49565" | OTHERCPT4 == "49568" | OTHERCPT4 == "49561" | OTHERCPT4 == "49566" | OTHERCPT4 == "49000" | OTHERCPT4 == "44005" | OTHERCPT4 == "49255" | OTHERCPT4 == "44602" | OTHERCPT4 == "44620" | OTHERCPT4 == "44120" | OTHERCPT4 == "15734" | OTHERCPT4 == "15830" | OTHERCPT4 == "NULL"
replace ZOTHERCPT5 = 1 if OTHERCPT5 == "49560" | OTHERCPT5 == "49565" | OTHERCPT5 == "49568" | OTHERCPT5 == "49561" | OTHERCPT5 == "49566" | OTHERCPT5 == "49000" | OTHERCPT5 == "44005" | OTHERCPT5 == "49255" | OTHERCPT5 == "44602" | OTHERCPT5 == "44620" | OTHERCPT5 == "44120" | OTHERCPT5 == "15734" | OTHERCPT5 == "15830" | OTHERCPT5 == "NULL"
replace ZOTHERCPT6 = 1 if OTHERCPT6 == "49560" | OTHERCPT6 == "49565" | OTHERCPT6 == "49568" | OTHERCPT6 == "49561" | OTHERCPT6 == "49566" | OTHERCPT6 == "49000" | OTHERCPT6 == "44005" | OTHERCPT6 == "49255" | OTHERCPT6 == "44602" | OTHERCPT6 == "44620" | OTHERCPT6 == "44120" | OTHERCPT6 == "15734" | OTHERCPT6 == "15830" | OTHERCPT6 == "NULL"
replace ZOTHERCPT7 = 1 if OTHERCPT7 == "49560" | OTHERCPT7 == "49565" | OTHERCPT7 == "49568" | OTHERCPT7 == "49561" | OTHERCPT7 == "49566" | OTHERCPT7 == "49000" | OTHERCPT7 == "44005" | OTHERCPT7 == "49255" | OTHERCPT7 == "44602" | OTHERCPT7 == "44620" | OTHERCPT7 == "44120" | OTHERCPT7 == "15734" | OTHERCPT7 == "15830" | OTHERCPT7 == "NULL"
replace ZOTHERCPT8 = 1 if OTHERCPT8 == "49560" | OTHERCPT8 == "49565" | OTHERCPT8 == "49568" | OTHERCPT8 == "49561" | OTHERCPT8 == "49566" | OTHERCPT8 == "49000" | OTHERCPT8 == "44005" | OTHERCPT8 == "49255" | OTHERCPT8 == "44602" | OTHERCPT8 == "44620" | OTHERCPT8 == "44120" | OTHERCPT8 == "15734" | OTHERCPT8 == "15830" | OTHERCPT8 == "NULL"
replace ZOTHERCPT9 = 1 if OTHERCPT9 == "49560" | OTHERCPT9 == "49565" | OTHERCPT9 == "49568" | OTHERCPT9 == "49561" | OTHERCPT9 == "49566" | OTHERCPT9 == "49000" | OTHERCPT9 == "44005" | OTHERCPT9 == "49255" | OTHERCPT9 == "44602" | OTHERCPT9 == "44620" | OTHERCPT9 == "44120" | OTHERCPT9 == "15734" | OTHERCPT9 == "15830" | OTHERCPT9 == "NULL"
replace ZOTHERCPT10 = 1 if OTHERCPT10 == "49560" | OTHERCPT10 == "49565" | OTHERCPT10 == "49568" | OTHERCPT10 == "49561" | OTHERCPT10 == "49566" | OTHERCPT10 == "49000" | OTHERCPT10 == "44005" | OTHERCPT10 == "49255" | OTHERCPT10 == "44602" | OTHERCPT10 == "44620" | OTHERCPT10 == "44120" | OTHERCPT10 == "15734" | OTHERCPT10 == "15830" | OTHERCPT10 == "NULL"
replace ZCONCPT1 = 1 if CONCPT1 == "49560" | CONCPT1 == "49565" | CONCPT1 == "49568" | CONCPT1 == "49561" | CONCPT1 == "49566" | CONCPT1 == "49000" | CONCPT1 == "44005" | CONCPT1 == "49255" | CONCPT1 == "44602" | CONCPT1 == "44620" | CONCPT1 == "44120" | CONCPT1 == "15734" | CONCPT1 == "15830" | CONCPT1 == "NULL"
replace ZCONCPT2 = 1 if CONCPT2 == "49560" | CONCPT2 == "49565" | CONCPT2 == "49568" | CONCPT2 == "49561" | CONCPT2 == "49566" | CONCPT2 == "49000" | CONCPT2 == "44005" | CONCPT2 == "49255" | CONCPT2 == "44602" | CONCPT2 == "44620" | CONCPT2 == "44120" | CONCPT2 == "15734" | CONCPT2 == "15830" | CONCPT2 == "NULL"
replace ZCONCPT3 = 1 if CONCPT3 == "49560" | CONCPT3 == "49565" | CONCPT3 == "49568" | CONCPT3 == "49561" | CONCPT3 == "49566" | CONCPT3 == "49000" | CONCPT3 == "44005" | CONCPT3 == "49255" | CONCPT3 == "44602" | CONCPT3 == "44620" | CONCPT3 == "44120" | CONCPT3 == "15734" | CONCPT3 == "15830" | CONCPT3 == "NULL"
replace ZCONCPT4 = 1 if CONCPT4 == "49560" | CONCPT4 == "49565" | CONCPT4 == "49568" | CONCPT4 == "49561" | CONCPT4 == "49566" | CONCPT4 == "49000" | CONCPT4 == "44005" | CONCPT4 == "49255" | CONCPT4 == "44602" | CONCPT4 == "44620" | CONCPT4 == "44120" | CONCPT4 == "15734" | CONCPT4 == "15830" | CONCPT4 == "NULL"
replace ZCONCPT5 = 1 if CONCPT5 == "49560" | CONCPT5 == "49565" | CONCPT5 == "49568" | CONCPT5 == "49561" | CONCPT5 == "49566" | CONCPT5 == "49000" | CONCPT5 == "44005" | CONCPT5 == "49255" | CONCPT5 == "44602" | CONCPT5 == "44620" | CONCPT5 == "44120" | CONCPT5 == "15734" | CONCPT5 == "15830" | CONCPT5 == "NULL"
replace ZCONCPT6 = 1 if CONCPT6 == "49560" | CONCPT6 == "49565" | CONCPT6 == "49568" | CONCPT6 == "49561" | CONCPT6 == "49566" | CONCPT6 == "49000" | CONCPT6 == "44005" | CONCPT6 == "49255" | CONCPT6 == "44602" | CONCPT6 == "44620" | CONCPT6 == "44120" | CONCPT6 == "15734" | CONCPT6 == "15830" | CONCPT6 == "NULL"
replace ZCONCPT7 = 1 if CONCPT7 == "49560" | CONCPT7 == "49565" | CONCPT7 == "49568" | CONCPT7 == "49561" | CONCPT7 == "49566" | CONCPT7 == "49000" | CONCPT7 == "44005" | CONCPT7 == "49255" | CONCPT7 == "44602" | CONCPT7 == "44620" | CONCPT7 == "44120" | CONCPT7 == "15734" | CONCPT7 == "15830" | CONCPT7 == "NULL"
replace ZCONCPT8 = 1 if CONCPT8 == "49560" | CONCPT8 == "49565" | CONCPT8 == "49568" | CONCPT8 == "49561" | CONCPT8 == "49566" | CONCPT8 == "49000" | CONCPT8 == "44005" | CONCPT8 == "49255" | CONCPT8 == "44602" | CONCPT8 == "44620" | CONCPT8 == "44120" | CONCPT8 == "15734" | CONCPT8 == "15830" | CONCPT8 == "NULL"
replace ZCONCPT9 = 1 if CONCPT9 == "49560" | CONCPT9 == "49565" | CONCPT9 == "49568" | CONCPT9 == "49561" | CONCPT9 == "49566" | CONCPT9 == "49000" | CONCPT9 == "44005" | CONCPT9 == "49255" | CONCPT9 == "44602" | CONCPT9 == "44620" | CONCPT9 == "44120" | CONCPT9 == "15734" | CONCPT9 == "15830" | CONCPT9 == "NULL"
replace ZCONCPT10 = 1 if CONCPT10 == "49560" | CONCPT10 == "49565" | CONCPT10 == "49568" | CONCPT10 == "49561" | CONCPT10 == "49566" | CONCPT10 == "49000" | CONCPT10 == "44005" | CONCPT10 == "49255" | CONCPT10 == "44602" | CONCPT10 == "44620" | CONCPT10 == "44120" | CONCPT10 == "15734" | CONCPT10 == "15830" | CONCPT10 == "NULL"

drop if ZCPT == 0 | ZOTHERCPT1 == 0 | ZOTHERCPT2 == 0 | ZOTHERCPT3 == 0 | ZOTHERCPT4 == 0 | ZOTHERCPT5 == 0 | ZOTHERCPT6 == 0 | ZOTHERCPT7 == 0 | ZOTHERCPT8 == 0 | ZOTHERCPT9 == 0 | ZOTHERCPT10 == 0 | ZCONCPT1 == 0 | ZCONCPT2 == 0 | ZCONCPT3 == 0 | ZCONCPT4 == 0 | ZCONCPT5 == 0 | ZCONCPT6 == 0 | ZCONCPT7 == 0 | ZCONCPT8 == 0 | ZCONCPT9 == 0 | ZCONCPT10 == 0

*23,831 observations deleted, 61,818 remain

tab CPT
tab CONCPT1
tab CONCPT2
tab CONCPT3
tab CONCPT4
tab CONCPT5
tab CONCPT6
tab CONCPT7
tab CONCPT8
tab CONCPT9
tab CONCPT10

tab OTHERCPT1
tab OTHERCPT2
tab OTHERCPT3
tab OTHERCPT4
tab OTHERCPT5
tab OTHERCPT6
tab OTHERCPT7
tab OTHERCPT8
tab OTHERCPT9
tab OTHERCPT10

tab DISCHDEST

drop if DISCHDEST == "Against Medical Advice (AMA)"
*63 deleted, 61,755 remain

drop if DISCHDEST == "Expired"
*218 deleted, 61,537 remain

drop if DISCHDEST == "Acute Care Hospital" | DISCHDEST == "Separate Acute Care"
*103 deleted, 61,434 remain

drop if Age == "90+"
*323 deletedm, 61,111 remain

drop if DOptoDis == -99
*165 deleted, 60,946

count if DOptoDis > 30

tab DOptoDis

drop if DOptoDis > 10
*1,464 deleted, 59, 482 remain

tab SURGSPEC

tab Complication
tab UNPLANNEDREADMISSION1
tab RETURNOR

tab RACE_NEW
tab ETHNICITY_HISPANIC
tab DOptoDis UNPLANNEDREADMISSION1

save "Y:\Tyler Zander\NSQIP Hernia\HerniaV3.dta", replace

*****************************************************************
* Feature Engineering

clear
use "Y:\Tyler Zander\NSQIP Hernia\HerniaV3.dta"

* Address making -99 values missing values
* List of variables
local vars HEIGHT WEIGHT PRSODM PRBUN PRCREAT PRALBUM PRBILI PRSGOT PRALKPH PRWBC PRHCT PRPLATE PRPTT PRINR OPTIME HtoODay TOTHLOS DOTHSYSEP DOTHSESHOCK DOptoDis

* Loop through each variable and replace -99 with missing value
foreach var in `vars' {
    replace `var' = . if `var' == -99
}

count if DOptoDis > 30

* Clean Data

destring Age, replace
tostring CaseID, replace

**************
* Address ASA Class
* Generate a new numeric variable with missing values
gen ASACLASS = .

* Recode the string values to corresponding numeric values
replace ASACLASS = 1 if ASACLAS == "1-No Disturb"
replace ASACLASS = 2 if ASACLAS == "2-Mild Disturb"
replace ASACLASS = 3 if ASACLAS == "3-Severe Disturb"
replace ASACLASS = 4 if ASACLAS == "4-Life Threat"
replace ASACLASS = 5 if ASACLAS == "5-Moribund"

drop ASACLAS

rename ASACLASS ASACLAS

*Address Null Values
replace UNPLANNEDREADMISSION1 = "No" if UNPLANNEDREADMISSION1 == "NULL"

* List of variables
local vars ETHNICITY_HISPANIC TRANST DISCHDEST ANESTHES FNSTATUS2

* Loop through each variable and replace "Unknown" with missing string value
foreach var in `vars' {
    replace `var' = "" if `var' == "Unknown"
}


* Create initial complication variables
* First, replace -99 values to missing values 
* List of variables
local vars DSUPINFEC DWNDINFD DORGSPCSSI DDEHIS DOUPNEUMO DREINTUB DPULEMBOL DFAILWEAN DOPRENAFL DURNINFEC DCNSCVA DCDARREST DCDMI DOTHBLEED DOTHDVT RETORPODAYS DOTHCDIFF

* Loop through each variable and replace -99 with missing value
foreach var in `vars' {
    replace `var' = . if `var' == -99
}

gen InitialShock = "No"
replace InitialShock = "Yes" if DOTHSESHOCK < DOptoDis

gen InitialSepsis = "No"
replace InitialSepsis = "Yes" if DOTHSYSEP < DOptoDis

gen InitialSUPINFEC = "No"
replace InitialSUPINFEC = "Yes" if DSUPINFEC < DOptoDis

gen InitialWNDINFD = "No"
replace InitialWNDINFD = "Yes" if DWNDINFD < DOptoDis

gen InitialORGSPCSSI = "No"
replace InitialORGSPCSSI = "Yes" if DORGSPCSSI < DOptoDis

gen InitialDEHIS = "No"
replace InitialDEHIS = "Yes" if DDEHIS < DOptoDis

gen InitialOUPNEUMO = "No"
replace InitialOUPNEUMO = "Yes" if DOUPNEUMO < DOptoDis

gen InitialREINTUB = "No"
replace InitialREINTUB = "Yes" if DREINTUB < DOptoDis

gen InitialPULEMBOL = "No"
replace InitialPULEMBOL = "Yes" if DPULEMBOL < DOptoDis

gen InitialFAILWEAN = "No"
replace InitialFAILWEAN = "Yes" if DFAILWEAN < DOptoDis

gen InitialOPRENAFL = "No"
replace InitialOPRENAFL = "Yes" if DOPRENAFL < DOptoDis

gen InitialURNINFEC = "No"
replace InitialURNINFEC = "Yes" if DURNINFEC < DOptoDis

gen InitialCNSCVA = "No"
replace InitialCNSCVA = "Yes" if DCNSCVA < DOptoDis

gen InitialCDARREST = "No"
replace InitialCDARREST = "Yes" if DCDARREST < DOptoDis

gen InitialCDMI = "No"
replace InitialCDMI = "Yes" if DCDMI < DOptoDis

gen InitialOTHBLEED = "No"
replace InitialOTHBLEED = "Yes" if DOTHBLEED < DOptoDis

gen InitialOTHDVT = "No"
replace InitialOTHDVT = "Yes" if DOTHDVT < DOptoDis

gen InitialREOPERATION1 = "No"
replace InitialREOPERATION1 = "Yes" if RETORPODAYS < DOptoDis

gen InitialOTHCDIFF = "No"
replace InitialOTHCDIFF = "Yes" if DOTHCDIFF < DOptoDis

* Combine Acute care hospital categories
replace TRANST = "Acute care hospital transfer" if inlist(TRANST, "Acute care hospital", "From acute care hospital inpatient")

* Combine Home categories
replace TRANST = "Home" if inlist(TRANST, "Home/Permanent residence", "Not transferred (admitted from home)")

* Combine Other categories
replace TRANST = "Other" if inlist(TRANST, "Other facility", "Transfer from other")

* Relabel the variable
label variable TRANST "Origin Status (Combined)"

* Display the new distribution
tab TRANST

* Combine Acute Care Hospital categories
replace DISCHDEST = "Acute Care Hospital" if inlist(DISCHDEST, "Acute Care Hospital", "Separate Acute Care")

* Combine Home categories
replace DISCHDEST = "Home" if inlist(DISCHDEST, "Home", "Home/Permanent Residence")

* Relabel the variable
label variable DISCHDEST "Discharge Destination (Combined)"

* Display the new distribution
tab DISCHDEST

tab RACE_NEW

gen RACE_COMBINED = RACE_NEW
replace RACE_COMBINED = "Multiple races" if inlist(RACE_NEW, "White,Asian", "Asian,Some Other Race", "Black or African American,American Indian or Alaska Native", "Race combinations with low frequency", "White,American Indian or Alaska Native", "White,Black or African American", "White,Some Other Race")
replace RACE_COMBINED = "Native Hawaiian or Pacific Islander" if inlist(RACE_NEW, "Native Hawaiian or Other Pacific Islander", "Native Hawaiian or Pacific Islander")

label define race_combined_label 1 "American Indian or Alaska Native" 2 "Asian" 3 "Black or African American" 4 "Multiple races" 5 "Native Hawaiian or Pacific Islander" 6 "Some Other Race" 7 "Unknown/Not Reported" 8 "White"
encode RACE_COMBINED, gen(RACE_COMBINED_NUM) label(race_combined_label)

tab RACE_COMBINED_NUM, missing

summarize RACE_COMBINED_NUM

mdesc ETHNICITY_HISPANIC

save "Y:\Tyler Zander\NSQIP Hernia\HerniaV4.dta", replace

*****************************************************************
*Tabulate and keep predictors

clear
use "Y:\Tyler Zander\NSQIP Hernia\HerniaV4.dta"

tab UNPLANNEDREADMISSION1

tab SEX
mdesc SEX

tab RACE_COMBINED_NUM
mdesc RACE_COMBINED_NUM

tab ETHNICITY_HISPANIC
mdesc ETHNICITY_HISPANIC

tab WORKRVU
mdesc WORKRVU

tab TRANST
mdesc TRANST

tab INOUT

tab Age
mdesc Age

tab DISCHDEST
mdesc DISCHDEST

tab ANESTHES
mdesc ANESTHES

tab SURGSPEC
mdesc SURGSPEC

tab HEIGHT
mdesc HEIGHT

tab WEIGHT
mdesc WEIGHT

tab DIABETES
mdesc DIABETES

tab SMOKE
mdesc SMOKE

tab FNSTATUS2
mdesc FNSTATUS2

tab VENTILAT
mdesc VENTILAT

tab HXCOPD
mdesc HXCOPD

tab ASCITES
mdesc ASCITES

tab HXCHF
mdesc HXCHF

tab HYPERMED
mdesc HYPERMED

tab DIALYSIS
mdesc DIALYSIS

tab DISCANCR
mdesc DISCANCR

tab STEROID
mdesc STEROID

tab BLEEDDIS
mdesc BLEEDDIS

tab TRANSFUS
mdesc TRANSFUS

tab PRSEPIS
mdesc PRSEPIS

tab SSSIPATOS
mdesc SSSIPATOS

tab DSSIPATOS
mdesc DSSIPATOS

tab OSSIPATOS
mdesc OSSIPATOS

tab PNAPATOS
mdesc PNAPATOS

tab VENTPATOS
mdesc VENTPATOS

tab UTIPATOS
mdesc UTIPATOS

tab SEPSISPATOS
mdesc SEPSISPATOS

tab SEPSHOCKPATOS
mdesc SEPSHOCKPATOS

tab UNPLANNEDREADMISSION1
mdesc UNPLANNEDREADMISSION1

tab ASACLAS
mdesc ASACLAS

tab InitialShock
mdesc InitialShock

tab InitialSepsis
mdesc InitialSepsis

tab InitialSUPINFEC
mdesc InitialSUPINFEC

tab InitialWNDINFD
mdesc InitialWNDINFD

tab InitialORGSPCSSI
mdesc InitialORGSPCSSI

tab InitialDEHIS
mdesc InitialDEHIS

tab InitialOUPNEUMO
mdesc InitialOUPNEUMO

tab InitialREINTUB
mdesc InitialREINTUB

tab InitialPULEMBOL
mdesc InitialPULEMBOL

tab InitialFAILWEAN
mdesc InitialFAILWEAN

tab InitialOPRENAFL
mdesc InitialOPRENAFL

tab InitialURNINFEC
mdesc InitialURNINFEC

tab InitialCNSCVA
mdesc InitialCNSCVA

tab InitialCDARREST
mdesc InitialCDARREST

tab InitialCDMI
mdesc InitialCDMI

tab InitialOTHBLEED
mdesc InitialOTHBLEED

tab InitialOTHDVT
mdesc InitialOTHDVT

tab InitialREOPERATION1
mdesc InitialREOPERATION1

tab InitialOTHCDIFF
mdesc InitialOTHCDIFF

tab TRANST

mdesc

keep CaseID RACE_COMBINED_NUM ETHNICITY_HISPANIC INOUT SEX WORKRVU TRANST Age DISCHDEST ANESTHES SURGSPEC HEIGHT WEIGHT PRSODM PRBUN PRCREAT PRALBUM PRBILI PRSGOT PRALKPH PRWBC PRHCT PRPLATE PRPTT PRINR DIABETES SMOKE FNSTATUS2 VENTILAT HXCOPD ASCITES HXCHF HYPERMED DIALYSIS DISCANCR STEROID BLEEDDIS TRANSFUS PRSEPIS MORTPROB MORBPROB OPTIME HtoODay DOptoDis SSSIPATOS DSSIPATOS OSSIPATOS PNAPATOS VENTPATOS UTIPATOS SEPSISPATOS SEPSHOCKPATOS UNPLANNEDREADMISSION1 ASACLAS InitialShock InitialSepsis InitialSUPINFEC InitialWNDINFD InitialORGSPCSSI InitialDEHIS InitialOUPNEUMO InitialREINTUB InitialPULEMBOL InitialFAILWEAN InitialOPRENAFL InitialURNINFEC InitialCNSCVA InitialCDARREST InitialCDMI InitialOTHBLEED InitialOTHDVT InitialREOPERATION1 InitialOTHCDIFF Hernia Mesh HerniaRecurrent Initialincar Recurincar ExLap Enterolysis Omentectomy Enterorrhaphy Closure_Enterostomy Enterectomy Component_Separation Panniculectomy

save "Y:\Tyler Zander\NSQIP Hernia\HerniaV5.dta", replace

*****************************************************************

*Combine race categories
clear
use "Y:\Tyler Zander\NSQIP Hernia\HerniaV5.dta"

generate race_new = .
replace race_new = 1 if inlist(RACE_COMBINED_NUM, 1, 2, 3, 4, 5, 6)
replace race_new = 2 if RACE_COMBINED_NUM == 8
replace race_new = . if RACE_COMBINED_NUM == .

label define race_new_label_z 1 "Non-white" 2 "White"
label values race_new race_new_label_z

drop RACE_COMBINED_NUM
tab race_new, missing

mdesc race_new
mdesc ETHNICITY_HISPANIC

tab ETHNICITY_HISPANIC, missing

***********
*Feature engineer PATOS to prevent data leakage

gen ZSSSIPATOS = "No"
replace ZSSSIPATOS = "Yes" if SSSIPATOS == "Yes" & InitialSUPINFEC == "Yes"

gen ZDSSIPATOS = "No"
replace ZDSSIPATOS = "Yes" if DSSIPATOS == "Yes" & InitialWNDINFD == "Yes"

gen ZOSSIPATOS = "No"
replace ZOSSIPATOS = "Yes" if OSSIPATOS == "Yes" & InitialORGSPCSSI == "Yes"

gen ZPNAPATOS = "No"
replace ZPNAPATOS = "Yes" if PNAPATOS == "Yes" & InitialOUPNEUMO == "Yes"

gen ZVENTPATOS = "No"
replace ZVENTPATOS = "Yes" if VENTPATOS == "Yes" & InitialFAILWEAN == "Yes"

gen ZUTIPATOS = "No"
replace ZUTIPATOS = "Yes" if UTIPATOS == "Yes" & InitialURNINFEC == "Yes"

gen ZSEPSISPATOS = "No"
replace ZSEPSISPATOS = "Yes" if SEPSISPATOS == "Yes" & InitialSepsis == "Yes"

gen ZSEPSHOCKPATOS = "No"
replace ZSEPSHOCKPATOS = "Yes" if SEPSHOCKPATOS == "Yes" & InitialShock == "Yes"

* Rename variables by removing Z prefix

drop SSSIPATOS DSSIPATOS OSSIPATOS PNAPATOS VENTPATOS UTIPATOS SEPSISPATOS SEPSHOCKPATOS

rename ZSSSIPATOS SSSIPATOS
rename ZDSSIPATOS DSSIPATOS
rename ZOSSIPATOS OSSIPATOS
rename ZPNAPATOS PNAPATOS
rename ZVENTPATOS VENTPATOS
rename ZUTIPATOS UTIPATOS
rename ZSEPSISPATOS SEPSISPATOS
rename ZSEPSHOCKPATOS SEPSHOCKPATOS

save "Y:\Tyler Zander\NSQIP Hernia\HerniaV6.dta", replace
export delimited "Y:\Tyler Zander\NSQIP Hernia\HerniaV6.csv", replace

*****************************************************************
*Tables and Significance Testing

clear
use "Y:\Tyler Zander\NSQIP Hernia\HerniaV6.dta"

table1_mc, by(UNPLANNEDREADMISSION1) vars(race_new cat\ ETHNICITY_HISPANIC cat\ INOUT cat\ SEX cat\ TRANST cat\ DISCHDEST cat\ ANESTHES cat\ SURGSPEC cat\ DIABETES cat\ SMOKE cat\ FNSTATUS2 cat\ VENTILAT cat\ HXCOPD cat\ ASCITES cat\ HXCHF cat\ HYPERMED cat\ DIALYSIS cat\ DISCANCR cat\ STEROID cat\ BLEEDDIS cat\ TRANSFUS cat\ PRSEPIS cat\ SSSIPATOS cat\ DSSIPATOS cat\ OSSIPATOS cat\ PNAPATOS cat\ VENTPATOS cat\ UTIPATOS cat\ SEPSISPATOS cat\ SEPSHOCKPATOS cat\ InitialShock cat\ InitialSepsis cat\ InitialSUPINFEC cat\ InitialWNDINFD cat\ InitialORGSPCSSI cat\ InitialDEHIS cat\ InitialOUPNEUMO cat\ InitialREINTUB cat\ InitialPULEMBOL cat\ InitialFAILWEAN cat\ InitialOPRENAFL cat\ InitialURNINFEC cat\ InitialCNSCVA cat\ InitialCDARREST cat\ InitialCDMI cat\ InitialOTHBLEED cat\ InitialOTHDVT cat\ InitialREOPERATION1 cat\ InitialOTHCDIFF cat\ Hernia cat\ Mesh cat\ HerniaRecurrent cat\ Initialincar cat\ Recurincar cat\ ExLap cat\ Enterolysis cat\ Omentectomy cat\ Enterorrhaphy cat\ Closure_Enterostomy cat\ Enterectomy cat\ Component_Separation cat\ Panniculectomy cat\) total(before) saving(ZV6HerniaChiSq.csv)

table1_mc, by(UNPLANNEDREADMISSION1) vars(Age conts\ HEIGHT conts\ WEIGHT conts\ PRSODM conts\ PRBUN conts\ PRCREAT conts\ PRALBUM conts\ PRBILI conts\ PRSGOT conts\ PRALKPH conts\ PRWBC conts\ PRHCT conts\ PRPLATE conts\ PRPTT conts\ PRINR conts\ MORTPROB conts\ MORBPROB conts\ OPTIME conts\ HtoODay conts\ DOptoDis conts\ ASACLAS conts\ WORKRVU conts\) total(before) saving(Z6HerniaMWU.csv)

table1_mc, by(UNPLANNEDREADMISSION1) vars(SSSIPATOS cat\ DSSIPATOS cat\ OSSIPATOS cat\ PNAPATOS cat\ VENTPATOS cat\ UTIPATOS cat\ SEPSISPATOS cat\ SEPSHOCKPATOS cat\) total(before) saving(ZV6HerniaChiSqPATOS.csv)
